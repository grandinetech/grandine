1. **一次情報集約 & 仕様読解**

   * DOCUMENT\_URL を全クロールし、API 仕様・設計変更ログ・外部 PDF・監査レポートを収集
   * アセット種別・資金フロー・ロール権限をマッピングし、初期アーキテクチャ図を生成

2. **構造把握パス（@audit フラグ付け）**

   * ファイルを論理順に並べ、各コントラクトを上から下へ読み取り
   * 送金・アクセス制御・複雑演算箇所に `@audit`／`@audit-info` マークを付与
   * データライフサイクル（生成→変換→破棄）を頭に再構築して“危険ノード”を赤字化

3. **深掘り検証パス（PoC 化）**

   * すべての `@audit` を再訪問し、Foundry/Hardhat で単体テスト or fork テストを作成
   * 関数呼び出しシーケンスとストレージ遷移をトレースし、脆弱性の有無を確定
   * 再現不可なら False Positive と記録、再現成功なら利益見積もりを付与

4. **既知パターン照合**

   * `@security-agent/docs/checklist.md` のキーワードとマッチング
   * `@security-agent/docs/past_attack_scenarios.jsonl` の signature 類似度を算出し、過去事例との関連を可視化
   * 一致パターンは Severity をブースト、未知パターンは新規ライブラリ候補として登録

5. **組み合わせリスク評価（コンポーザビリティ）**

   * コールグラフ・データ依存グラフを生成し、クロスコントラクト／クロスチェーン連鎖を探索
   * 権限交差・時間差攻撃・価格共有ミスなど“部分的安全性の罠”をシミュレート
   * 重大な組み合わせ経路には PoC を実装し、全体インパクトを再評価

6. **経済的実行性分析**

   * 各脆弱性ごとに攻撃コスト（ガス・資本・流動性）と潜在利益を計算
   * 手数料・ペナルティ・スリッページを考慮し、攻撃者収支が正になるか判定
   * 収支が負ならリスクをダウングレード、黒字なら Critical/High を維持

7. **レポート統合 & 学習フィードバック**

   * `@security-agent/outputs/02_SPEC.json` の `compliance_matrix`・`potential_security_concerns` を更新
   * 新規パターンは `pattern_library.json` に追加し、次回検出精度を向上
   * 見落とし理由を自己分析してチェックリストへ追記（継続学習サイクル）

8. **最終レビュー & 責任ある開示準備**

   * PoC・経済評価・修正提案を揃え、優先度順に整理
   * 再度タイムロック・アップグレード・緊急停止など運用面を確認し、影響範囲を最終確認
   * バグバウンティ提出用の要約・技術詳細・再現手順を生成し、責任ある開示プロセスへ移行
