# ホワイトハッカー向け包括的スマートコントラクト脆弱性チェックリスト（2025年版）

## 📋 使用方法
- ✅ 各項目をチェックして脆弱性の有無を確認
- 🔴 高優先度項目は必須チェック
- 🟡 中優先度項目は重要
- 🟢 新技術項目は該当する場合のみ
- 🔧 自動化可能項目はツールでの検証を推奨

---

## 🔴 【最優先】アクセス制御脆弱性（2024年最大損失額: $953.2M）

### 基本的なアクセス制御
- [ ] 管理者専用機能に`onlyOwner`や`onlyAdmin`修飾子が適用されているか
- [ ] 状態変更機能に適切な権限チェックが存在するか
- [ ] 資金移動機能に認証が実装されているか
- [ ] `public`関数で重要な操作を実行していないか
- [ ] 権限チェックをバイパスする方法がないか

### Role-Based Access Control (RBAC)
- [ ] ロールの階層構造が適切に設計されているか
- [ ] ロール付与・剥奪の権限が適切に制限されているか
- [ ] デフォルトロールの設定が安全か
- [ ] ロール変更時の状態整合性が保たれるか
- [ ] 過度に広範な権限が付与されていないか

### Multi-Signature Wallet
- [ ] 必要署名数の検証が正しく実装されているか
- [ ] 署名の重複使用が防止されているか
- [ ] 署名者の有効性チェックが実装されているか
- [ ] nonce管理が適切に行われているか
- [ ] 署名者リストの変更に適切な承認プロセスがあるか

### Proxy Contract権限管理
- [ ] プロキシ管理者の権限が適切に制限されているか
- [ ] アップグレード機能にタイムロックが実装されているか
- [ ] 実装コントラクトの初期化が安全か
- [ ] 実装コントラクトが直接呼び出し可能でないか
- [ ] セルフデストラクト機能が悪用可能でないか

---

## 🔴 【最優先】フィッシング対策（2024年最多インシデント: 296件、$1.05B損失）

### Wallet Connection攻撃
- [ ] 接続要求の詳細表示があるか
- [ ] 権限範囲の明確化があるか
- [ ] 定期的な権限見直し機能があるか
- [ ] 過度な権限要求を検出・警告するか
- [ ] 接続時の権限最小化が実装されているか

### Signature Phishing
- [ ] 署名内容の明確表示があるか
- [ ] 危険な署名の警告機能があるか
- [ ] 署名検証機能が実装されているか
- [ ] 偽装された署名要求を検出できるか
- [ ] ユーザーへの署名教育機能があるか

---

## 🔴 【最優先】秘密鍵管理（2024年第2位損失額: $855M）

### Private Key Management
- [ ] 鍵生成の安全性が確保されているか
- [ ] 鍵保存の暗号化があるか
- [ ] 鍵アクセスの制限があるか
- [ ] 平文での鍵保存がないか
- [ ] 不適切な鍵共有がないか

### Key Rotation
- [ ] 定期的な鍵更新機能があるか
- [ ] 古い鍵の無効化機能があるか
- [ ] 更新プロセスが安全か
- [ ] 鍵の長期使用を防ぐ仕組みがあるか
- [ ] 鍵更新の監査ログがあるか

---

## 🔴 【高優先度】価格オラクル操作

### Chainlink Oracle攻撃
- [ ] 複数のオラクルソースが使用されているか
- [ ] オラクルの更新頻度が適切か
- [ ] 価格偏差の検証が実装されているか
- [ ] オラクル障害時の対応が適切か
- [ ] 単一オラクル依存になっていないか

### TWAP Manipulation
- [ ] TWAP期間が適切に設定されているか（推奨: 30分以上）
- [ ] 価格操作の検出機能があるか
- [ ] 複数期間のTWAPが比較されているか
- [ ] フラッシュローンとの組み合わせ攻撃が防止されているか
- [ ] 異常な価格変動の検出機能があるか

### Multi-Oracle攻撃
- [ ] オラクル間の価格乖離検証があるか
- [ ] 異常値の除外機能があるか
- [ ] オラクル重み付けが適切か
- [ ] 相関オラクルの同時操作が検出できるか
- [ ] オラクル障害時のフォールバック機能があるか

---

## 🔴 【高優先度】リエントランシー攻撃

### 従来型リエントランシー
- [ ] CEI（Checks-Effects-Interactions）パターンが適用されているか
- [ ] ReentrancyGuardが適切に使用されているか
- [ ] 外部呼び出し前に状態が更新されているか
- [ ] 複数の外部呼び出しが安全に処理されているか
- [ ] 🔧 Slitherでリエントランシーパターンを検出済みか

### 🟢 Transient Storage関連リエントランシー（EIP-1153）
- [ ] Transient Storage変数がリエントランシー攻撃に対して安全か
- [ ] 低ガス制限（2300 gas）でのリエントランシーが防止されているか
- [ ] `address.transfer`使用時の安全性が確保されているか
- [ ] Transient Storageの明示的クリアが実装されているか
- [ ] Multicall実行時の状態分離が適切か

---

## 🔴 【高優先度】フラッシュローン攻撃

### 基本的なフラッシュローン攻撃
- [ ] フラッシュローン実行中の状態変更が制限されているか
- [ ] 価格操作とフラッシュローンの組み合わせが防止されているか
- [ ] アトミック実行の制限があるか
- [ ] フラッシュローン検出機能があるか
- [ ] 借入・返済の整合性チェックがあるか

### 複合フラッシュローン攻撃
- [ ] 複数プロトコルを跨いだ攻撃が防止されているか
- [ ] フラッシュローン + ガバナンス攻撃が防止されているか
- [ ] 複雑な攻撃チェーンの検出機能があるか
- [ ] プロトコル間の状態依存性が安全か
- [ ] 緊急停止機能が適切に実装されているか

---

## 🟡 【中優先度】ガバナンス攻撃

### Flash Loan Governance攻撃
- [ ] 投票権の即座取得が制限されているか
- [ ] 提案実行に適切な遅延（推奨: 24-48時間）があるか
- [ ] 緊急実行機能が適切に制限されているか
- [ ] 投票期間が適切に設定されているか（推奨: 7日以上）
- [ ] 最小投票率要件があるか

### Vote Buying攻撃
- [ ] 投票権の移譲制限があるか
- [ ] 短期間での大量投票権取得が検出されるか
- [ ] 投票の匿名性が保護されているか
- [ ] 投票権の売買検出機能があるか
- [ ] 投票インセンティブが適切に設計されているか

### Governance Token経済攻撃
- [ ] トークン供給量の操作が防止されているか
- [ ] インフレーション攻撃が防止されているか
- [ ] 流動性操作の制限があるか
- [ ] トークン価格操作の検出機能があるか
- [ ] 供給量変更の透明性があるか

---

## 🟡 【中優先度】MEV関連攻撃

### Front-running攻撃
- [ ] 価格に敏感な操作が保護されているか
- [ ] コミット・リビール方式が実装されているか
- [ ] バッチ処理による保護があるか
- [ ] Private mempoolの使用が検討されているか
- [ ] 時間遅延による保護があるか

### Sandwich攻撃
- [ ] スリッページ保護が適切に設定されているか
- [ ] 最小受取量の設定が適切か
- [ ] 取引サイズの制限があるか
- [ ] 動的スリッページ機能があるか
- [ ] クロスプロトコル取引の保護があるか

### MEV-Boost関連
- [ ] ブロック構築プロセスが透明か
- [ ] バリデーター選択が公正か
- [ ] MEV分配が適切か
- [ ] Builder censorshipが検出されるか
- [ ] MEV抽出の制限があるか

---

## 🟢 【新技術】Account Abstraction (EIP-4337)

### UserOperation検証
- [ ] UserOperationの署名検証が適切か
- [ ] ガス制限の検証が正しく実装されているか
- [ ] nonce管理が適切に行われているか
- [ ] 実行フェーズでの状態変更が安全か
- [ ] UserOperation replay攻撃が防止されているか

### Paymaster攻撃
- [ ] Paymasterの承認ロジックが適切か
- [ ] ガス代計算に操作の余地がないか
- [ ] Paymaster資金の枯渇攻撃が防止されているか
- [ ] 無制限のガス代支払いがないか
- [ ] Paymaster選択プロセスが公正か

---

## 🟢 【新技術】Layer 2 / Rollup固有の脆弱性

### Sequencer操作攻撃
- [ ] Sequencerの中央集権化リスクが考慮されているか
- [ ] トランザクション順序操作が防止されているか
- [ ] Sequencerダウンタイム時の対応が適切か
- [ ] MEV抽出の制限があるか
- [ ] トランザクション検閲が検出されるか

### 状態ルート操作
- [ ] 状態ルートの検証が適切に実装されているか
- [ ] 不正な状態遷移が検出可能か
- [ ] チャレンジ期間が適切に設定されているか
- [ ] 状態ルート偽造が検出されるか
- [ ] Exit gameの安全性が確保されているか

---

## 🟢 【新技術】Intent-based Protocols

### Intent解釈の脆弱性
- [ ] Intent解釈ロジックが正確か
- [ ] 曖昧なIntentの処理が適切か
- [ ] Intent実行の原子性が保証されているか
- [ ] Intent誤解釈の検出機能があるか
- [ ] Intent検証機能が実装されているか

### Solver操作攻撃
- [ ] Solverの選択プロセスが公正か
- [ ] 実行結果の検証が適切か
- [ ] Solver間の競争が健全か
- [ ] Solver共謀の検出機能があるか
- [ ] Solver評価システムが適切か

---

## 🟡 【中優先度】クロスチェーン・ブリッジ

### Bridge Logic攻撃
- [ ] クロスチェーンメッセージの検証が適切か
- [ ] Merkle proof検証が正しく実装されているか
- [ ] 署名検証プロセスに欠陥がないか
- [ ] ミント・バーン機能の整合性があるか
- [ ] ブリッジ資金の会計が正確か

### 署名検証の脆弱性
- [ ] 必要署名数の検証が正しいか
- [ ] 署名者セットの管理が適切か
- [ ] 署名の重複使用が防止されているか
- [ ] チェーンID検証が実装されているか
- [ ] リプレイ攻撃が防止されているか

### Rate Limiting
- [ ] 引き出し制限が適切に設定されているか
- [ ] 異常な大口取引の検出機能があるか
- [ ] 緊急停止機能が実装されているか
- [ ] 段階的制限システムがあるか
- [ ] 監視・アラート機能があるか

---

## 🟡 【中優先度】DEX・AMM

### 入力検証の不備
- [ ] ユーザー提供アドレスの検証があるか
- [ ] 任意の外部呼び出しが防止されているか
- [ ] パラメータの境界値チェックがあるか
- [ ] 悪意あるトークンコントラクトへの対策があるか
- [ ] 🔧 入力検証パターンが自動検証されているか

### AMM数学の精度
- [ ] 手数料計算の精度が適切か
- [ ] トークンデシマルの違いが考慮されているか
- [ ] オーバーフロー・アンダーフローが防止されているか
- [ ] 丸め誤差が最小化されているか
- [ ] 不変条件の検証が実装されているか

### Double-Entrypoint Tokens
- [ ] ネイティブトークンとERC20表現の区別があるか
- [ ] 同一資産の重複処理が防止されているか
- [ ] トークンアドレスの検証が適切か
- [ ] 残高同期機能が正しく実装されているか
- [ ] 二重支払いが防止されているか

---

## 🟡 【中優先度】Lending・CDP

### 担保評価の脆弱性
- [ ] 複数オラクルによる価格検証があるか
- [ ] 流動性の低い担保の制限があるか
- [ ] 担保比率の動的調整機能があるか
- [ ] 価格操作の検出機能があるか
- [ ] 緊急時の担保凍結機能があるか

### 清算プロセス
- [ ] 清算条件の検証が適切か
- [ ] 清算実行の原子性が保証されているか
- [ ] 清算者への適切なインセンティブがあるか
- [ ] 部分清算機能が正しく実装されているか
- [ ] 清算プロセスの透明性があるか

### 非標準資産の処理
- [ ] NFT担保の適切な評価があるか
- [ ] カスタムトークンの安全な処理があるか
- [ ] 転送機能の検証が実装されているか
- [ ] 所有権確認の機能があるか
- [ ] 非標準インターフェースへの対応があるか

---

## 🟡 【中優先度】Staking・Farming

### 報酬計算の脆弱性
- [ ] 報酬計算の精度が適切か
- [ ] 再ステーキング時の報酬更新があるか
- [ ] 報酬の重複計算が防止されているか
- [ ] 報酬プールの枯渇対策があるか
- [ ] 報酬分配の公平性が保証されているか

### 無限ループ・DoS攻撃
- [ ] ループの境界が適切に設定されているか
- [ ] ガス制限による実行失敗が防止されているか
- [ ] 大量のステーカーへの対応があるか
- [ ] バッチ処理機能が実装されているか
- [ ] 緊急時の処理継続機能があるか

---

## 🟡 【中優先度】経済的攻撃

### Tokenomics攻撃
- [ ] トークン供給量の操作が防止されているか
- [ ] インフレーション率の上限があるか
- [ ] 供給量変更の透明性があるか
- [ ] 流動性操作の検出機能があるか
- [ ] 価格操作の制限があるか

### Market Making攻撃
- [ ] 自己取引の検出機能があるか
- [ ] 異常な出来高の検出があるか
- [ ] 大口取引の制限があるか
- [ ] 価格変動の監視機能があるか
- [ ] 協調的操作の検出機能があるか

---

## 🔧 自動化検証項目

### 静的解析（必須）
- [ ] **Slither**: リエントランシー、アクセス制御、整数オーバーフロー
- [ ] **Mythril**: 脆弱性パターン、シンボリック実行
- [ ] **Semgrep**: カスタムルールによる脆弱性検出
- [ ] **Solhint**: コーディング標準、ベストプラクティス
- [ ] **MythX**: 包括的な静的・動的解析

### 動的テスト（推奨）
- [ ] **Foundry Fuzzing**: ランダム入力による境界値テスト
- [ ] **Echidna**: プロパティベーステスト
- [ ] **Manticore**: シンボリック実行による深い解析
- [ ] **Hardhat**: 統合テスト、シナリオテスト
- [ ] **Custom Simulation**: 経済的攻撃シミュレーション

### 形式検証（高度）
- [ ] **Certora**: 数学的証明による検証
- [ ] **KEVM**: Ethereum仮想マシンの形式検証
- [ ] **Dafny**: 仕様記述言語による検証
- [ ] **TLA+**: システム仕様の検証
- [ ] **Coq**: 定理証明による検証

---

## 📊 優先度別チェック順序

### 🔴 Phase 1: 緊急対応項目（1-2日）
1. アクセス制御の基本チェック
2. フィッシング対策の確認
3. 秘密鍵管理の検証
4. 基本的なリエントランシー検査

### 🟡 Phase 2: 重要項目（3-5日）
1. 価格オラクル操作の検証
2. フラッシュローン攻撃の確認
3. ガバナンス攻撃の検査
4. MEV関連脆弱性の確認

### 🟢 Phase 3: 新技術項目（該当時）
1. Account Abstraction関連
2. Layer 2固有の脆弱性
3. Intent-based Protocol
4. Transient Storage関連

### 🔧 Phase 4: 自動化検証（並行実行）
1. 静的解析ツールの実行
2. 動的テストの実施
3. 経済的シミュレーション
4. 形式検証（必要に応じて）

---

## 📝 チェックリスト使用時の注意事項

### 基本原則
- **攻撃者の視点**: 常に「どうやって悪用できるか」を考える
- **経済的インセンティブ**: 攻撃の経済的実現可能性を評価する
- **複合攻撃**: 単一脆弱性だけでなく、組み合わせ攻撃を検討する
- **継続的監視**: デプロイ後も継続的な監視が必要

### 実践的アプローチ
1. **コンテキスト理解**: プロトコルの目的と仕組みを完全に理解する
2. **実際の使用**: プロトコルを実際に使用して動作を確認する
3. **テストスイート分析**: 既存テストの網羅性を評価する
4. **可視化**: アーキテクチャ図やフロー図を作成する
5. **段階的検証**: 優先度順に体系的にチェックする

### 報告とフォローアップ
- **明確な説明**: 脆弱性の影響と悪用方法を明確に説明
- **PoC提供**: 可能な限り概念実証コードを提供
- **修正提案**: 具体的な修正方法を提案
- **再検証**: 修正後の再検証を実施
- **継続的改善**: 新しい攻撃パターンの学習と反映

---

## 📚 参考資料・ツール

### 必読資料
- [OWASP Smart Contract Top 10 (2025)](https://owasp.org/www-project-smart-contract-top-10/)
- [CertiK Hack3d Report 2024](https://www.certik.com/resources/blog/hack3d-the-web3-security-report-2024)
- [OpenZeppelin Security Auditor's 2024 Rewind](https://blog.openzeppelin.com/web3-security-auditors-2024-rewind)
- [Ethereum Security Best Practices](https://consensys.github.io/smart-contract-best-practices/)

### 推奨ツール
- **静的解析**: Slither, Mythril, Semgrep, MythX
- **動的テスト**: Foundry, Echidna, Manticore
- **形式検証**: Certora, KEVM
- **監視**: Forta, OpenZeppelin Defender
- **シミュレーション**: Brownie, Custom frameworks

### コミュニティ・プラットフォーム
- **Code4rena**: 競争的監査プラットフォーム
- **Immunefi**: バグバウンティプラットフォーム
- **Cantina**: セキュリティ監査プラットフォーム
- **Secureum**: セキュリティ教育コミュニティ
- **Solodit**: 脆弱性データベース
